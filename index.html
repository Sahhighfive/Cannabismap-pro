<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canabismap - Legale Konsum-Zonen</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: #0a1f15;
}

#app {
height: 100vh;
display: flex;
flex-direction: column;
}

/* Header */
.header {
background: linear-gradient(135deg, #0c7f3e 0%, #0a6b34 100%);
color: white;
padding: 1rem 0;
box-shadow: 0 4px 12px rgba(12, 127, 62, 0.3);
}

.header-content {
max-width: 1200px;
margin: 0 auto;
padding: 0 1rem;
display: flex;
align-items: center;
justify-content: space-between;
}

.logo {
font-size: 1.5rem;
font-weight: bold;
display: flex;
align-items: center;
gap: 0.5rem;
}

.status-widget {
background: rgba(255, 255, 255, 0.95);
color: #333;
padding: 0.75rem 1rem;
border-radius: 12px;
font-weight: 600;
display: flex;
align-items: center;
gap: 0.5rem;
min-width: 200px;
}

.status-legal {
color: #0c7f3e;
}

.status-illegal {
color: #ff4444;
}

/* Main Content */
.main-content {
flex: 1;
display: flex;
position: relative;
}

/* Map */
.map-container {
flex: 1;
height: 100%;
}

/* Controls */
.controls {
position: absolute;
top: 1rem;
right: 1rem;
z-index: 1000;
display: flex;
flex-direction: column;
gap: 0.5rem;
}

.control-btn {
background: white;
border: none;
padding: 0.75rem 1rem;
border-radius: 8px;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
cursor: pointer;
font-weight: 600;
display: flex;
align-items: center;
gap: 0.5rem;
transition: all 0.3s ease;
}

.control-btn:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.control-btn.primary {
background: #0c7f3e;
color: white;
}

/* Info Panel */
.info-panel {
position: absolute;
bottom: 1rem;
left: 1rem;
right: 1rem;
background: rgba(255, 255, 255, 0.95);
padding: 1rem;
border-radius: 12px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
z-index: 1000;
backdrop-filter: blur(10px);
}

.distance-info {
font-size: 1.1rem;
font-weight: 600;
margin-bottom: 0.5rem;
color: #333;
}

.location-name {
color: #0c7f3e;
font-weight: 600;
margin-bottom: 0.5rem;
}

.quick-nav {
display: flex;
gap: 0.5rem;
margin-top: 0.5rem;
}

.nav-btn {
flex: 1;
background: #0c7f3e;
color: white;
border: none;
padding: 0.5rem;
border-radius: 6px;
cursor: pointer;
font-weight: 600;
}

/* Legal Zones */
.legal-zone {
background: rgba(12, 127, 62, 0.3);
border: 2px solid #0c7f3e;
border-radius: 8px;
}

.illegal-zone {
background: rgba(255, 68, 68, 0.3);
border: 2px solid #ff4444;
border-radius: 8px;
}

/* Legend */
.legend {
position: absolute;
top: 1rem;
left: 1rem;
background: rgba(255, 255, 255, 0.95);
padding: 1rem;
border-radius: 8px;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
z-index: 1000;
}

.legend-item {
display: flex;
align-items: center;
gap: 0.5rem;
margin: 0.5rem 0;
}

.legend-color {
width: 20px;
height: 20px;
border-radius: 4px;
}

.legal-color {
background: #0c7f3e;
}

.illegal-color {
background: #ff4444;
}

.user-color {
background: #007AFF;
}
</style>
</head>
<body>
<div id="app">
<!-- Header mit Status Widget -->
<header class="header">
<div class="header-content">
<div class="logo">
üåø Canabismap
</div>
<div class="status-widget" id="statusWidget">
<span>üåç Standort wird ermittelt...</span>
</div>
</div>
</header>

<!-- Hauptinhalt -->
<div class="main-content">
<!-- Karte -->
<div id="map" class="map-container"></div>

<!-- Legende -->
<div class="legend">
<h4>Legende:</h4>
<div class="legend-item">
<div class="legend-color legal-color"></div>
<span>Legale Konsum-Zone</span>
</div>
<div class="legend-item">
<div class="legend-color illegal-color"></div>
<span>Illegale Zone</span>
</div>
<div class="legend-item">
<div class="legend-color user-color"></div>
<span>Dein Standort</span>
</div>
</div>

<!-- Steuerung -->
<div class="controls">
<button class="control-btn" onclick="findMyLocation()">
üìç Mein Standort
</button>
<button class="control-btn primary" onclick="navigateToNearestLegal()">
üó∫Ô∏è Zum legalen Spot
</button>
</div>

<!-- Info Panel -->
<div class="info-panel" id="infoPanel" style="display: none;">
<div class="distance-info" id="distanceInfo"></div>
<div class="location-name" id="locationName"></div>
<div class="quick-nav">
<button class="nav-btn" onclick="navigateToCurrentNearest()">
üöÄ Jetzt navigieren
</button>
</div>
</div>
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Karte und Variablen initialisieren
let map;
let userMarker;
let userLocation = null;
let nearestLegalZone = null;

// Legale und illegale Zonen definieren (basierend auf deutschen Gesetzen)
const legalZones = [
// √ñffentliche Parks (legal f√ºr Konsum)
{ id: 1, name: "Volkspark Friedrichshain", lat: 52.5244, lng: 13.4380, type: "park", radius: 200 },
{ id: 2, name: "Tiergarten", lat: 52.5163, lng: 13.3509, type: "park", radius: 300 },
{ id: 3, name: "Tempelhofer Feld", lat: 52.4736, lng: 13.4056, type: "park", radius: 500 },
{ id: 4, name: "G√∂rlitzer Park", lat: 52.4975, lng: 13.4378, type: "park", radius: 150 },
{ id: 5, name: "Mauerpark", lat: 52.5439, lng: 13.4025, type: "park", radius: 180 },

// Weitere legale √∂ffentliche Bereiche
{ id: 6, name: "Spreeufer Ostbahnhof", lat: 52.5105, lng: 13.4345, type: "riverbank", radius: 100 },
{ id: 7, name: "Landwehrkanal Kreuzberg", lat: 52.4934, lng: 13.4145, type: "riverbank", radius: 120 }
];

const illegalZones = [
// Schulen (150m Radius verboten)
{ id: 101, name: "Gymnasium am Schloss", lat: 52.5200, lng: 13.4050, type: "school", radius: 150 },
{ id: 102, name: "Grundschule Mitte", lat: 52.5150, lng: 13.3900, type: "school", radius: 150 },

// Kinderg√§rten (100m Radius verboten)
{ id: 201, name: "Kita Sonnenschein", lat: 52.5250, lng: 13.4100, type: "kindergarten", radius: 100 },
{ id: 202, name: "Kindergarten Berlin-Mitte", lat: 52.5100, lng: 13.4000, type: "kindergarten", radius: 100 },

// Spielpl√§tze (100m Radius verboten)
{ id: 301, name: "Spielplatz Volkspark", lat: 52.5300, lng: 13.4200, type: "playground", radius: 100 },
{ id: 302, name: "Kinderspielplatz", lat: 52.5050, lng: 13.4150, type: "playground", radius: 100 },

// Fu√üg√§ngerzonen (komplette Zone)
{ id: 401, name: "Alexanderplatz", lat: 52.5215, lng: 13.4132, type: "pedestrian_zone", radius: 200 },
{ id: 402, name: "Kurf√ºrstendamm", lat: 52.5022, lng: 13.3286, type: "pedestrian_zone", radius: 150 }
];

// Karte initialisieren
function initMap() {
map = L.map('map').setView([52.5200, 13.4050], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '¬© OpenStreetMap contributors'
}).addTo(map);

// Legale Zonen anzeigen (GR√úN)
legalZones.forEach(zone => {
L.circle([zone.lat, zone.lng], {
color: '#0c7f3e',
fillColor: '#0c7f3e',
fillOpacity: 0.3,
radius: zone.radius
}).addTo(map).bindPopup(`
<div style="text-align: center;">
<h3 style="color: #0c7f3e; margin: 0 0 8px 0;">‚úÖ ${zone.name}</h3>
<p style="margin: 4px 0;">Legale Konsum-Zone</p>
<p style="margin: 4px 0; font-size: 12px;">${getZoneTypeDescription(zone.type)}</p>
</div>
`);
});

// Illegale Zonen anzeigen (ROT)
illegalZones.forEach(zone => {
L.circle([zone.lat, zone.lng], {
color: '#ff4444',
fillColor: '#ff4444',
fillOpacity: 0.3,
radius: zone.radius
}).addTo(map).bindPopup(`
<div style="text-align: center;">
<h3 style="color: #ff4444; margin: 0 0 8px 0;">‚ùå ${zone.name}</h3>
<p style="margin: 4px 0;">Illegale Zone</p>
<p style="margin: 4px 0; font-size: 12px;">${getZoneTypeDescription(zone.type)}</p>
</div>
`);
});

// Standort des Benutzers abfragen
findMyLocation();
}

// Standort des Benutzers finden
function findMyLocation() {
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(
position => {
userLocation = {
lat: position.coords.latitude,
lng: position.coords.longitude
};

// User Marker auf Karte setzen
if (userMarker) {
map.removeLayer(userMarker);
}

userMarker = L.marker([userLocation.lat, userLocation.lng], {
icon: L.divIcon({
className: 'user-marker',
html: 'üìç',
iconSize: [30, 30],
iconAnchor: [15, 30]
})
}).addTo(map).bindPopup('Dein aktueller Standort');

// Karte auf User zentrieren
map.setView([userLocation.lat, userLocation.lng], 16);

// Legalit√§tspr√ºfung durchf√ºhren
checkLegalStatus(userLocation.lat, userLocation.lng);
},
error => {
console.log('Standort konnte nicht abgerufen werden:', error);
updateStatusWidget('location-error', 'Standort nicht verf√ºgbar');
},
{
enableHighAccuracy: true,
timeout: 10000,
maximumAge: 60000
}
);
} else {
updateStatusWidget('location-error', 'Geolocation wird nicht unterst√ºtzt');
}
}

// Legalit√§tsstatus pr√ºfen
function checkLegalStatus(userLat, userLng) {
let isLegal = true;
let illegalReason = "";

// Pr√ºfe illegale Zonen
for (const zone of illegalZones) {
const distance = calculateDistance(userLat, userLng, zone.lat, zone.lng) * 1000; // in Meter

if (distance < zone.radius) {
isLegal = false;
illegalReason = `Zu nah an ${zone.name} (${Math.round(distance)}m)`;
break;
}
}

// Finde n√§chste legale Zone
nearestLegalZone = findNearestLegalZone(userLat, userLng);

// Status Widget aktualisieren
if (isLegal) {
updateStatusWidget('legal', '‚úÖ LEGAL - Du kannst hier konsumieren');
} else {
updateStatusWidget('illegal', `‚ùå ILLEGAL - ${illegalReason}`);
}

// Info Panel aktualisieren
updateInfoPanel();
}

// N√§chste legale Zone finden
function findNearestLegalZone(userLat, userLng) {
let nearest = null;
let minDistance = Infinity;

legalZones.forEach(zone => {
const distance = calculateDistance(userLat, userLng, zone.lat, zone.lng);
if (distance < minDistance) {
minDistance = distance;
nearest = zone;
}
});

return nearest;
}

// Status Widget aktualisieren
function updateStatusWidget(status, text) {
const widget = document.getElementById('statusWidget');
widget.innerHTML = text;
widget.className = 'status-widget';

if (status === 'legal') {
widget.classList.add('status-legal');
} else if (status === 'illegal') {
widget.classList.add('status-illegal');
}
}

// Info Panel aktualisieren
function updateInfoPanel() {
const panel = document.getElementById('infoPanel');
const distanceInfo = document.getElementById('distanceInfo');
const locationName = document.getElementById('locationName');

if (nearestLegalZone && userLocation) {
const distance = calculateDistance(
userLocation.lat, userLocation.lng,
nearestLegalZone.lat, nearestLegalZone.lng
) * 1000;

distanceInfo.textContent = `N√§chste legale Zone: ${Math.round(distance)}m entfernt`;
locationName.textContent = nearestLegalZone.name;
panel.style.display = 'block';
} else {
panel.style.display = 'none';
}
}

// Zur n√§chsten legalen Zone navigieren
function navigateToNearestLegal() {
if (nearestLegalZone) {
navigateTo(nearestLegalZone.lat, nearestLegalZone.lng);
} else {
alert('Keine legale Zone in der N√§he gefunden.');
}
}

// Zur aktuell n√§chsten legalen Zone navigieren
function navigateToCurrentNearest() {
if (userLocation) {
const nearest = findNearestLegalZone(userLocation.lat, userLocation.lng);
if (nearest) {
navigateTo(nearest.lat, nearest.lng);
}
}
}

// Navigation starten
function navigateTo(lat, lng) {
const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=walking`;
window.open(url, '_blank');
}

// Entfernung berechnen
function calculateDistance(lat1, lon1, lat2, lon2) {
const R = 6371; // Erdradius in Kilometern
const dLat = (lat2 - lat1) * Math.PI / 180;
const dLon = (lon2 - lon1) * Math.PI / 180;
const a =
Math.sin(dLat/2) * Math.sin(dLat/2) +
Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
Math.sin(dLon/2) * Math.sin(dLon/2);
const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
return R * c;
}

// Zonentyp Beschreibung
function getZoneTypeDescription(type) {
const descriptions = {
'park': '√ñffentlicher Park - Legal f√ºr Konsum',
'riverbank': 'Flussufer - Legal f√ºr Konsum',
'school': 'Schule - 150m Umkreis verboten',
'kindergarten': 'Kindergarten - 100m Umkreis verboten',
'playground': 'Spielplatz - 100m Umkreis verboten',
'pedestrian_zone': 'Fu√üg√§ngerzone - Hier verboten'
};
return descriptions[type] || 'Unbekannte Zone';
}

// Karte initialisieren wenn Seite geladen
document.addEventListener('DOMContentLoaded', initMap);
</script>
</body>
</html>
