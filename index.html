<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canabismap Pro - Legale Cannabis Standorte</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: #0a1f15;
}
#map {
height: 100vh;
width: 100vw;
}

.status-banner {
position: fixed;
top: 0;
left: 0;
right: 0;
z-index: 1000;
padding: 1rem;
text-align: center;
font-weight: bold;
font-size: 1.2rem;
background: rgba(255, 68, 68, 0.95);
color: white;
border-bottom: 3px solid #cc0000;
}

.legal {
background: rgba(12, 127, 62, 0.95);
border-bottom-color: #0a6b34;
}

.action-buttons {
position: fixed;
bottom: 20px;
left: 50%;
transform: translateX(-50%);
z-index: 1000;
display: flex;
gap: 1rem;
}

.action-btn {
background: #0c7f3e;
color: white;
border: none;
padding: 12px 24px;
border-radius: 25px;
font-weight: bold;
cursor: pointer;
}

.info-panel {
position: fixed;
top: 80px;
right: 20px;
z-index: 999;
background: rgba(255,255,255,0.95);
padding: 1.5rem;
border-radius: 15px;
max-width: 300px;
border: 2px solid #0c7f3e;
}
</style>
</head>
<body>
<div class="status-banner" id="statusBanner">üåø Pr√ºfe Legalit√§t...</div>
<div id="map"></div>
<div class="action-buttons">
<button class="action-btn" onclick="navigateToNearestLegal()">üó∫Ô∏è Zum legalen Spot</button>
<button class="action-btn" onclick="buyApp()">üí∞ App kaufen</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Karte initialisieren
const map = L.map('map').setView([51.1657, 10.4515], 6); // Deutschland Zentrum

// Karten-Layer hinzuf√ºgen
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '¬© OpenStreetMap'
}).addTo(map);

// VERBOTENE ZONEN (basierend auf deutschen Gesetzen)
const forbiddenZones = [
// Schulen (100m Radius)
{ type: 'school', lat: 52.5200, lng: 13.4050, radius: 100, name: "Schule am Schloss" },
{ type: 'school', lat: 48.1351, lng: 11.5820, radius: 100, name: "M√ºnchner Gymnasium" },
{ type: 'school', lat: 50.1109, lng: 8.6821, radius: 100, name: "Frankfurter Schule" },

// Kinderg√§rten/Kitas (100m Radius)
{ type: 'kindergarten', lat: 52.5150, lng: 13.4020, radius: 100, name: "Kita Mitte" },
{ type: 'kindergarten', lat: 48.1374, lng: 11.5755, radius: 100, name: "M√ºnchner Kindergarten" },

// Spielpl√§tze (100m Radius)
{ type: 'playground', lat: 52.5250, lng: 13.4080, radius: 100, name: "Stadtpark Spielplatz" },
{ type: 'playground', lat: 50.9352, lng: 6.9531, radius: 100, name: "K√∂lner Spielplatz" },

// Fu√üg√§ngerzonen (komplette Zone)
{ type: 'pedestrian_zone', lat: 52.5194, lng: 13.4067, radius: 200, name: "Berliner Fu√üg√§ngerzone" },
{ type: 'pedestrian_zone', lat: 48.1368, lng: 11.5770, radius: 150, name: "M√ºnchner Innenstadt" }
];

// LEGALE SPOTS (basierend auf bubatzkarte.de und deutschen Gesetzen)
const legalSpots = [
// √ñffentliche Parks (legal)
{ name: "Tiergarten Berlin", lat: 52.5163, lng: 13.3509, type: "park", description: "Gro√üer √∂ffentlicher Park - legaler Konsum erlaubt" },
{ name: "Englischer Garten M√ºnchen", lat: 48.1635, lng: 11.6032, type: "park", description: "Beliebter Park - legal f√ºr Cannabis-Konsum" },
{ name: "Rheinpark K√∂ln", lat: 50.9506, lng: 6.9651, type: "park", description: "Entspannte Atmosph√§re am Rhein - legal" },

// Legale Cannabis-Clubs (ab 1. Juli 2024)
{ name: "Cannabis Club Berlin", lat: 52.5300, lng: 13.4100, type: "club", description: "Anerkannter Cannabis Social Club" },
{ name: "Hanf Verein M√ºnchen", lat: 48.1400, lng: 11.5700, type: "club", description: "Mitglieder-Club f√ºr legalen Konsum" },

// √ñffentliche Pl√§tze (legal au√üerhalb von Fu√üg√§ngerzonen)
{ name: "Tempelhofer Feld Berlin", lat: 52.4736, lng: 13.4056, type: "public_area", description: "Weite Fl√§chen - legal f√ºr Konsum" },
{ name: "Alsterwiesen Hamburg", lat: 53.5616, lng: 10.0139, type: "public_area", description: "Beliebte Wiesen an der Alster - legal" }
];

// Marker f√ºr legale Spots (GR√úN)
legalSpots.forEach(spot => {
const legalIcon = L.icon({
iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTUiIGN5PSIxNSIgcj0iMTQiIGZpbGw9IiMwYzdmM2UiIHN0cm9rZT0iIzA2NmMzZSIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjE1IiB5PSIyMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPsOkPC90ZXh0Pgo8L3N2Zz4=',
iconSize: [30, 30],
iconAnchor: [15, 15]
});

L.marker([spot.lat, spot.lng], { icon: legalIcon })
.addTo(map)
.bindPopup(`<b>‚úÖ ${spot.name}</b><br>${spot.description}<br><button onclick="navigateTo(${spot.lat}, ${spot.lng})">üó∫Ô∏è Hier navigieren</button>`);
});

// Verbotene Zonen anzeigen (ROTE Kreise)
forbiddenZones.forEach(zone => {
L.circle([zone.lat, zone.lng], {
color: 'red',
fillColor: '#f03',
fillOpacity: 0.3,
radius: zone.radius
}).addTo(map).bindPopup(`‚ùå ${zone.name}<br>Verboten: ${getZoneDescription(zone.type)}`);
});

// Standort des Benutzers abfragen
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(
position => {
const userLat = position.coords.latitude;
const userLng = position.coords.longitude;

// Benutzerposition auf der Karte anzeigen
const userIcon = L.icon({
iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIGZpbGw9IiMwMDcBRkYiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CjxjaXJjbGUgY3g9IjE0IiBjeT0iMTIiIHI9IjUiIGZpbGw9IiMwMDcBRkYiLz4KPC9zdmc+',
iconSize: [24, 24],
iconAnchor: [12, 12]
});

L.marker([userLat, userLng], { icon: userIcon })
.addTo(map)
.bindPopup('Dein aktueller Standort');

// Karte auf Benutzer zentrieren
map.setView([userLat, userLng], 15);

// Legalit√§tspr√ºfung durchf√ºhren
checkLegalStatus(userLat, userLng);
},
error => {
console.log('Standort konnte nicht abgerufen werden:', error);
// Fallback zu Berlin
checkLegalStatus(52.5200, 13.4050);
}
);
}

function getZoneDescription(type) {
const descriptions = {
'school': 'Schule (100m Umkreis verboten)',
'kindergarten': 'Kindergarten/Kita (100m Umkreis verboten)',
'playground': 'Spielplatz (100m Umkreis verboten)',
'pedestrian_zone': 'Fu√üg√§ngerzone (7-20 Uhr verboten)'
};
return descriptions[type] || 'Verbotene Zone';
}

function checkLegalStatus(userLat, userLng) {
let isLegal = true;
let reason = "";
let nearestLegal = findNearestLegalSpot(userLat, userLng);

// Pr√ºfe verbotene Zonen
for (const zone of forbiddenZones) {
const distance = calculateDistance(userLat, userLng, zone.lat, zone.lng) * 1000; // in Meter

if (distance < zone.radius) {
isLegal = false;
reason = `Zu nah an ${zone.name} (${Math.round(distance)}m)`;
break;
}
}

// Pr√ºfe Uhrzeit f√ºr Fu√üg√§ngerzonen
if (isLegal) {
const now = new Date();
const hour = now.getHours();
const isDaytime = hour >= 7 && hour < 20;

// Vereinfachte Pr√ºfung ob in Innenstadt/Fu√üg√§ngerzone
if (isDaytime && isInCityCenter(userLat, userLng)) {
isLegal = false;
reason = "Innenstadt/Fu√üg√§ngerzone (7-20 Uhr verboten)";
}
}

const statusBanner = document.getElementById('statusBanner');
if (isLegal) {
statusBanner.textContent = '‚úÖ LEGAL - Du kannst hier konsumieren';
statusBanner.className = 'status-banner legal';
} else {
statusBanner.textContent = `‚ùå ILLEGAL - ${reason}`;
statusBanner.className = 'status-banner';

if (nearestLegal) {
const distance = calculateDistance(userLat, userLng, nearestLegal.lat, nearestLegal.lng) * 1000;
statusBanner.textContent += ` | N√§chster legaler Spot: ${Math.round(distance)}m`;
}
}
}

function isInCityCenter(lat, lng) {
// Vereinfachte Pr√ºfung f√ºr Innenst√§dte
const cityCenters = [
{ lat: 52.5200, lng: 13.4050, radius: 1000 }, // Berlin Mitte
{ lat: 48.1351, lng: 11.5820, radius: 800 }, // M√ºnchen Altstadt
{ lat: 50.1109, lng: 8.6821, radius: 700 }, // Frankfurt Innenstadt
{ lat: 53.5511, lng: 9.9937, radius: 900 }, // Hamburg Zentrum
{ lat: 50.9375, lng: 6.9603, radius: 600 } // K√∂ln Innenstadt
];

for (const center of cityCenters) {
const distance = calculateDistance(lat, lng, center.lat, center.lng) * 1000;
if (distance < center.radius) {
return true;
}
}
return false;
}

function findNearestLegalSpot(userLat, userLng) {
let nearest = null;
let minDistance = Infinity;

legalSpots.forEach(spot => {
const distance = calculateDistance(userLat, userLng, spot.lat, spot.lng);
if (distance < minDistance) {
minDistance = distance;
nearest = spot;
}
});

return nearest;
}

function calculateDistance(lat1, lon1, lat2, lon2) {
const R = 6371; // Erdradius in Kilometern
const dLat = (lat2 - lat1) * Math.PI / 180;
const dLon = (lon2 - lon1) * Math.PI / 180;
const a =
Math.sin(dLat/2) * Math.sin(dLat/2) +
Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
Math.sin(dLon/2) * Math.sin(dLon/2);
const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
return R * c;
}

function navigateTo(lat, lng) {
window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
}

function navigateToNearestLegal() {
if (navigator.geolocation) {
navigator.geolocation.getCurrentPosition(position => {
const userLat = position.coords.latitude;
const userLng = position.coords.longitude;
const nearest = findNearestLegalSpot(userLat, userLng);

if (nearest) {
navigateTo(nearest.lat, nearest.lng);
} else {
alert('Kein legaler Spot in der N√§he gefunden.');
}
});
}
}

function buyApp() {
alert('Canabismap Pro - 4,99‚Ç¨\n\n‚úÖ Echtzeit Legal/Illegal Status nach deutschen Gesetzen\n‚úÖ Navigation zu legalen Spots\n‚úÖ Verbotene Zonen werden angezeigt\n‚úÖ Einmalzahlung, keine Abos!');
}
</script>
</body>
</html>
